doc_topic_distr = lda_model$fit_transform(x = dtm,
n_iter = 1000,
convergence_tol = 0.001,
n_check_convergence = 20,
progressbar = F)
# Most relevant words for each topic
lda_model$get_top_words(n = 15, lambda = 0.4)
ordered_articles = apply(doc_topic_distr, 2, function(t) order(t, decreasing = T))
titles = apply(ordered_articles[1:10,], 2, function(a) corpus[a,]$titles)
titles
dtm = create_dtm(iterator, vectorizer)
lda_model = LDA$new(n_topics = 4,
doc_topic_prior = 0.1,
topic_word_prior = 0.01)
doc_topic_distr = lda_model$fit_transform(x = dtm,
n_iter = 1000,
convergence_tol = 0.001,
n_check_convergence = 20,
progressbar = F)
# Most relevant words for each topic
lda_model$get_top_words(n = 15, lambda = 0.4)
ordered_articles = apply(doc_topic_distr, 2, function(t) order(t, decreasing = T))
titles = apply(ordered_articles[1:10,], 2, function(a) corpus[a,]$titles)
titles
titles = apply(ordered_articles[1:20,], 2, function(a) corpus[a,]$titles)
titles
lda_model = LDA$new(n_topics = 4,
doc_topic_prior = 0.1,
topic_word_prior = 0.01)
doc_topic_distr = lda_model$fit_transform(x = dtm,
n_iter = 1000,
convergence_tol = 0.001,
n_check_convergence = 20,
progressbar = F)
# Most relevant words for each topic
lda_model$get_top_words(n = 15, lambda = 0.4)
ordered_articles = apply(doc_topic_distr, 2, function(t) order(t, decreasing = T))
titles = apply(ordered_articles[1:20,], 2, function(a) corpus[a,]$titles)
titles
plot(amounts$num_dates, amounts$t1, type="l", col="red", ylim=c(0,1), legend="test")
plot(amounts$num_dates, amounts$t1, type="l", col="red", ylim=c(0,1), ylab="test")
plot(amounts$num_dates, amounts$t1, type="l", col="red", ylim=c(0,1), ylab="test")
lines(amounts$num_dates, amounts$t2, col="green", ylim=c(0,1), ylab="ok")
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
legend(1, 95, legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"),
col=(1:4), lty=1:2, cex=0.8)
legend(1, 1, legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"),
col=(1:4), lty=1:2, cex=0.8)
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
legend(1, 1, legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"), col=(1:4), lty=1:2, cex=0.8)
legend(1, legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"), col=(1:4), lty=1:2, cex=0.8)
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
legend(1, legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"), col=(1:4), lty=1:2, cex=0.8)
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
legend(10, legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"), col=(1:4), lty=1:2, cex=0.8)
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
legend(10, legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"), col=(1:4), lty=1, cex=0.8)
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
legend(10, legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"), col=(1:4), lty=c(1,1,1,1), cex=0.8)
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
legend(1, legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"), col=(1:4), lty=c(1,1,1,1), cex=0.8)
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
legend(1988, legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"), col=(1:4), lty=c(1,1,1,1), cex=0.8)
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
legend(1, legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"))
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
legend(1, legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"))
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
legend("bottomleft", legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"))
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
legend("topright", legend=c("Topic 1", "Topic 2", "Topic 3", "Topic 4"), col=(1:4), lty=1, cex=0.8)
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
legend("topright",
col=(1:4),
lty=1,
cex=0.8,
legend=c("Topic 1",
"Topic 2",
"Topic 3",
"Topic 4"))
relevant_topic_documents(topics, corpus$titles)
# Finding most relevant articles for each topic
relevant_topic_documents <- function(topics, documents, n=10) {
ordered_articles = apply(topics, 2, function(t) order(t, decreasing = T))
titles = apply(ordered_articles[1:n,], 2, function(a) documents[a])
titles
}
relevant_topic_documents(topics, corpus$titles)
dates = as.POSIXlt(corpus$dates)
# Setting all days to 1
dates$mday = rep(1, length(dates))
# Months are stored as a value between 0 and 11
# We bring them back to a trimestrial value :
# [0,1,2,3,4,5,6,7,8,9,10,11] ==> [0,0,0,3,3,3,6,6,6,9,9,9]
dates$mon = unlist(lapply(dates$mon, function(m) floor(m/3 + 0.1) * 3))
topics_d = topics
topics_d$dates = unlist(lapply(dates, as.String))
topics_d$dates = unlist(lapply(dates, as.String))
library(dplyr)
amounts = topics_d %>%
group_by(dates) %>%
summarise(t1 = mean(V1),
t2 = mean(V2),
t3 = mean(V3),
t4 = mean(V4))
amounts$num_dates = as.POSIXlt(amounts$dates)
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
legend("topright",
col=(1:4),
lty=1,
cex=0.8,
legend=c("Topic 1",
"Topic 2",
"Topic 3",
"Topic 4"))
relevant_topic_documents(topics, corpus$titles, 30)
amounts = topics_d %>%
group_by(dates) %>%
summarise(t1 = sum(V1),
t2 = sum(V2),
t3 = sum(V3),
t4 = sum(V4))
amounts$num_dates = as.POSIXlt(amounts$dates)
plot(amounts$num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(amounts$num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(amounts$num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(amounts$num_dates, amounts$t4, col=4, ylim=c(0,1))
legend("topright",
col=(1:4),
lty=1,
cex=0.8,
legend=c("Topic 1",
"Topic 2",
"Topic 3",
"Topic 4"))
plot(amounts$num_dates, amounts$t1, col=1, type="l")
lines(amounts$num_dates, amounts$t2, col=2)
lines(amounts$num_dates, amounts$t3, col=3)
lines(amounts$num_dates, amounts$t4, col=4)
legend("topright",
col=(1:4),
lty=1,
cex=0.8,
legend=c("Topic 1",
"Topic 2",
"Topic 3",
"Topic 4"))
amounts = topics_d %>%
group_by(dates) %>%
summarise(t1 = mean(V1),
t2 = mean(V2),
t3 = mean(V3),
t4 = mean(V4))
amounts$num_dates = as.POSIXlt(amounts$dates)
plot(amounts$num_dates, amounts$t1, col=1, type="l")
lines(amounts$num_dates, amounts$t2, col=2)
lines(amounts$num_dates, amounts$t3, col=3)
lines(amounts$num_dates, amounts$t4, col=4)
legend("topright",
col=(1:4),
lty=1,
cex=0.8,
legend=c("Topic 1",
"Topic 2",
"Topic 3",
"Topic 4"))
amounts = topics_d %>%
group_by(dates) %>%
summarise(t1 = mean(V1),
t2 = mean(V2),
t3 = mean(V3),
t4 = mean(V4))
amounts = apply(amounts, 1, function(x) x/sum(x))
View(amounts)
amounts = topics_d %>%
group_by(dates) %>%
summarise(t1 = mean(V1),
t2 = mean(V2),
t3 = mean(V3),
t4 = mean(V4))
amounts[2:6] = apply(amounts[2:6], 1, function(x) x/sum(x))
amounts[,2:6] = apply(amounts[,2:6], 1, function(x) x/sum(x))
amounts[,2]
View(amounts)
amounts = topics_d %>%
group_by(dates) %>%
summarise(t1 = mean(V1),
t2 = mean(V2),
t3 = mean(V3),
t4 = mean(V4))
num_dates = as.POSIXlt(amounts$dates)
plot(num_dates, amounts$t1, col=1, type="l")
lines(num_dates, amounts$t2, col=2)
lines(num_dates, amounts$t3, col=3)
lines(num_dates, amounts$t4, col=4)
legend("topright",
col=(1:4),
lty=1,
cex=0.8,
legend=c("Topic 1",
"Topic 2",
"Topic 3",
"Topic 4"))
plot(num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(num_dates, amounts$t4, col=4, ylim=c(0,1))
legend("topright",
col=(1:4),
lty=1,
cex=0.8,
legend=c("Topic 1",
"Topic 2",
"Topic 3",
"Topic 4"))
topics = read.csv("./data/topics_probabilities.csv")
corpus = read.csv("./data/nyt.csv", sep="\t", stringsAsFactors=F)
# Finding most relevant articles for each topic
relevant_topic_documents <- function(topics, documents, n=10) {
ordered_articles = apply(topics, 2, function(t) order(t, decreasing = T))
titles = apply(ordered_articles[1:n,], 2, function(a) documents[a])
titles
}
relevant_topic_documents(topics, corpus$titles, 30)
dates = as.POSIXlt(corpus$dates)
# Setting all days to 1
dates$mday = rep(1, length(dates))
# Months are stored as a value between 0 and 11
# We bring them back to a trimestrial value :
# [0,1,2,3,4,5,6,7,8,9,10,11] ==> [0,0,0,3,3,3,6,6,6,9,9,9]
dates$mon = unlist(lapply(dates$mon, function(m) floor(m/3 + 0.1) * 3))
topics_d = topics
topics_d$dates = unlist(lapply(dates, as.String))
library(dplyr)
amounts = topics_d %>%
group_by(dates) %>%
summarise(t1 = mean(V1),
t2 = mean(V2),
t3 = mean(V3),
t4 = mean(V4))
num_dates = as.POSIXlt(amounts$dates)
plot(num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(num_dates, amounts$t4, col=4, ylim=c(0,1))
legend("topright",
col=(1:4),
lty=1,
cex=0.8,
legend=c("Topic 1",
"Topic 2",
"Topic 3",
"Topic 4"))
entities = read.csv("./data/full_entities.csv")
source("notebook.Rmd")
setwd("D:/Data Perso/Google Drive/Mon M2/Text Mining/projet/Documents-Corpus-Summarizing/src")
source("functions.r")
iterator = get_iterator(corpus$textx)
iterator = get_iterator(corpus$texts)
vocabulary = get_vocabulary(iterator)
dtm = get_dtm(vocabulary)
dtm.idf = get_dtm_tfidf(dtm)
search(
"soviet gorbatchev russia ussr",
corpus$texts,
vocab,
dtm.tfidf
)
make.request <- function(phrase) {
unlist(strsplit(tolower(phrase), " "))
}
vectorize <- function(words, vocab) {
v <- rep(0, nrow(vocab))
for (w in words) {
idx = which(vocab$term == w)
v[idx] = v[idx] + 1
}
v
}
cosinus <- function(u, v) {
if (all(u == 0) || all(v == 0)) return(0)
u <- u / sqrt(sum(u ^ 2))
v <- v / sqrt(sum(v ^ 2))
c(u %*% v)
}
closest <- function(doc, dtm, k) {
distance = apply(dtm, 1, function(x) cosinus(x, doc))
if (k == 0) k <- length(distance)
ord = order(distance, decreasing = T)
ord[1:k]
}
search <- function(phrase, corpus, vocab, dtm, k=10) {
r = vectorize(make.request(phrase), vocab)
ord <- closest(r, dtm, k)
corpus[ord]
}
search(
"soviet gorbatchev russia ussr",
corpus$texts,
vocab,
dtm.tfidf
)
search(
"soviet gorbatchev russia ussr",
corpus$texts,
vocabulary,
dtm.tfidf
)
dtm.tfidf = get_dtm_tfidf(dtm)
search(
"soviet gorbatchev russia ussr",
corpus$texts,
vocabulary,
dtm.tfidf
)
result = search(
"soviet gorbatchev russia ussr",
corpus$texts,
vocabulary,
dtm.tfidf,
k=20
)
corpus$titles[result,]
result
search <- function(phrase, corpus, vocab, dtm, k=10) {
r = vectorize(make.request(phrase), vocab)
ord <- closest(r, dtm, k)
ord
}
result = search(
"soviet gorbatchev russia ussr",
corpus$texts,
vocabulary,
dtm.tfidf,
k=20
)
result
corpus$titles[result,]
corpus$titles[result]
to_trimestrial_dates <- function(dates) {
# Setting all days to 1
dates$mday = rep(1, length(dates))
# Months are stored as a value between 0 and 11
# We bring them back to a trimestrial value :
# [0,1,2,3,4,5,6,7,8,9,10,11] ==> [0,0,0,3,3,3,6,6,6,9,9,9]
dates$mon = unlist(lapply(dates$mon, function(m) floor(m/3 + 0.1) * 3))
dates
}
group_by_dates <- function(dataframe, ...) {
amounts = dataframe %>%
group_by(dates) %>%
summarise(...)
amounts
}
group_by_dates(topics_d, t1 = mean(V1),
t2 = mean(V2),
t3 = mean(V3),
t4 = mean(V4))
group_by_dates(topics_d, t1 = mean(V1),
t2 = mean(V2),
t3 = mean(V3))
amounts = group_by_dates(topics_d,
t1 = mean(V1),
t2 = mean(V2),
t3 = mean(V3),
t4 = mean(V4))
num_dates = as.POSIXlt(amounts$dates)
plot(num_dates, amounts$t1, col=1, ylim=c(0,1), type="l")
lines(num_dates, amounts$t2, col=2, ylim=c(0,1))
lines(num_dates, amounts$t3, col=3, ylim=c(0,1))
lines(num_dates, amounts$t4, col=4, ylim=c(0,1))
legend("topright",
col=(1:4),
lty=1,
cex=0.8,
legend=c("Topic 1",
"Topic 2",
"Topic 3",
"Topic 4"))
as.Date(c("2019-01-01", "2019-01-02"))
as.Date(c("2019-01-01", "2019-01-03")) < as.Date("2019-01-02")
max(as.Date(c("2019-01-01", "2019-01-03")))
# Return indices of dates which are in the range : date_min <= d < date_max
filter_dates <- function(dates, date_min = NULL, date_max = NULL) {
dates = as.Date(dates)
if (is.null(date_min)) date_min = min(dates)
if (is.null(date_max)) date_max = max(dates)
which(date_min <= dates & dates < date_max)
}
corpus = read.csv("./data/nyt.csv", sep="\t", stringsAsFactors=F)
corpus = read.csv("../data/nyt.csv", sep="\t", stringsAsFactors=F)
# Return indices of dates which are in the range : date_min <= d < date_max
filter_dates <- function(dates, date_min = NULL, date_max = NULL) {
dates = as.Date(dates)
if (is.null(date_min)) date_min = min(dates) else date_min = as.Date(date_min)
if (is.null(date_max)) date_max = max(dates) else date_max = as.Date(date_max)
which(date_min <= dates & dates < date_max)
}
View(corpus)
filter_dates(corpus$dates, date_min = "1988-01-01")
filter_dates(corpus$dates, date_min = "1988-01-01", date_max = "1989-01-01")
corpus[filter_dates(corpus$dates, date_min = "1988-01-01", date_max = "1989-01-01"),]
a=corpus[filter_dates(corpus$dates, date_min = "1988-01-01", date_max = "1989-01-01"),]
View(a)
filter_entity <- function(entities, type, token, indices=NULL) {
if (!is.null(indices)) {
entities = entities[entities$doc_id == indices,]
}
entities[entities$entity == token & entities$entity_type == type,]
}
filter_entity(entities, "PERSON", "Cuomo", indices=1)
entities = read.csv("../data/full_entities.csv")
filter_entity(entities, "PERSON", "Cuomo", indices=1)
grepl("", "x")
filter_entity(entities, "PERSON", "Cuomo", indices=1)
1 in c(1,2,3)
filter_entity <- function(entities, types=NULL, tokens=NULL, indices=NULL) {
if (!is.null(indices)) {
entities = entities[entities$doc_id %in% indices,]
}
if (!is.null(types)) {
entities = entities[entities$entity_type %in% types,]
}
if (!is.null(tokens)) {
entities = entities[entities$entity %in% tokens,]
}
entities
}
filter_entity(entities, types="PERSON", tokens="Cuomo", indices=1)
filter_entity(entities, types="PERSON", tokens=c("Cuomo", "Stan_Lundine"), indices=1)
filter_entity(entities, types="PERSON", tokens=c("Cuomo", "Stan_Lundine"), indices=c(1,2,3))
filter_entity <- function(entities, types=NULL, tokens=NULL, indices=NULL) {
if (!is.null(indices)) {
entities = entities[entities$doc_id %in% indices,]
}
if (!is.null(types)) {
entities = entities[entities$entity_type %in% types,]
}
if (!is.null(tokens)) {
entities = entities[entities$entity %in% tokens,]
}
unique(entities$doc_id)
}
filter_entity(entities, types="PERSON", tokens=c("Cuomo", "Stan_Lundine"), indices=c(1,2,3))
filter_entity(entities, types="PERSON", tokens=c("Cuomo", "Stan_Lundine"), indices=1:1000)
a = entities[entities$doc_id %in% b,]
b=filter_entity(entities, types="PERSON", tokens=c("Cuomo", "Stan_Lundine"), indices=1:1000)
a = entities[entities$doc_id %in% b,]
View(a)
filter_entity <- function(entities, types=NULL, tokens=NULL, indices=NULL, entities_only=F) {
if (!is.null(indices)) {
entities = entities[entities$doc_id %in% indices,]
}
if (!is.null(types)) {
entities = entities[entities$entity_type %in% types,]
}
if (!is.null(tokens)) {
entities = entities[entities$entity %in% tokens,]
}
if (entities_only) {
entities
}
else {
unique(entities$doc_id)
}
}
filter_entity(entities, types="PERSON", tokens=c("Cuomo", "Stan_Lundine"), indices=c(1,2,3))
filter_entity(entities, types="PERSON", tokens=c("Cuomo", "Stan_Lundine"), indices=c(1,2,3), entities_only = T)
